+++
title = 'JMH基准性能测试'

date = 2025-08-05T09:57:20+08:00

categories = ["性能测试"]

tags = ["JMH","基准测试"]

+++



#### Java性能测试利器 - JMH基准性能测试



> 背景：
>
> 在庞大的系统中进行开发，为了保证系统性能，我们通常会针对不同的维度进行性能测试，常见的测试方式如压测等，由于系统逐渐庞大，我们的测试粒度会响应的变小（从上到下进行测试成本较高，更多的时候我们需要针对下层的方法进行测试）。本次的主题将展开面向方法层级的性能测试，以保证可以从下而上的不断进行性能优化。



##### 基准性能测试

基准测试是指通过设计科学的测试方法、测试工具和测试系统，实现对一类测试对象的某项性能指标进行定量的和可对比的测试。

举个例子：

测试显卡性能：3DMark



---



##### JMH是什么

###### Java Microbenchmark Harness (JMH)

JMH is a Java harness for building, running, and analysing nano/micro/milli/macro benchmarks written in Java and other languages targeting the JVM.
JMH 是一个 Java 工具，用于构建、运行和分析用 Java 和其他针对 JVM 的语言编写的纳米/微/毫/宏基准测试。

[openjdk/jmh：https://openjdk.org/projects/code-tools/jmh --- openjdk/jmh: https://openjdk.org/projects/code-tools/jmh](https://github.com/openjdk/jmh)

JMH由OpenJDK团队维护，官方于JDK1.9将JMH集成到了JDK中。



---



##### 为什么需要使用JMH



Java的性能测试是比较难的，因为JVM越来越智能，平台会在不同的阶段帮助我们优化代码，经过JVM优化后的代码就会存在“失真”的问题，可能会导致实际的性能和真实运行时的测试结果差之毫厘。

我们常见的性能测试存在以下问题：

1. 有时候发现程序越跑越快
2. 代码调换下顺序每个阶段的性能就存在差距





###### 标准化测试工具带来以下好处

量化性能表现

基准测试通过可重复的实验，将代码的执行效率（如响应时间、吞吐量、内存占用等）转化为具体数值，避免了 "感觉更快" 或 "好像更慢" 这类主观判断，为性能优化提供客观依据。

验证优化效果

当对代码进行重构、算法改进或 JVM 参数调整时，基准测试能准确衡量优化前后的性能差异，判断优化是否真正有效，避免因盲目优化引入新问题。

揭示性能瓶颈

通过对比不同模块、不同实现方式的基准数据，可定位系统中的性能短板（如低效的集合操作、频繁的 GC、不合理的锁竞争等），指导开发者有针对性地进行优化。

保障代码质量

在持续集成流程中嵌入基准测试，能及时发现代码变更引入的性能退化，防止性能问题随着版本迭代逐渐累积，确保系统长期保持高效运行。

指导技术选型

面对多种实现方案（如不同的集合类、序列化框架、并发工具），基准测试可通过对比其在特定场景下的性能表现，帮助开发者选择最适合当前业务需求的技术方案。



---



##### JMH使用手册
