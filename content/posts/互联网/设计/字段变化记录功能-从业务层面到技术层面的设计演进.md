+++
title = '字段变化记录功能-从业务层面到技术层面的设计演进'

date = 2025-06-07T16:10:11+08:00

categories = ["设计"]

tags = ["功能设计"]

draft = true

+++



##### 由字段变化记录功能引发的从业务层面到技术层面的设计演进



> 背景：
>
> 在诸多系统配置类/信息展示类页面中，多数会需要记录和展示关键字段的变化，如：开关状态，通常需要记录：状态修改时间、原始值、新值、变更说明。但是实际开发中，我们的状态值往往是码值，例如 开-00 关-01，在记录存储中则面临一个问题，需要对类似的字段进行转义，因为我们需要展示。
>
> 现在要把字段记录功能进行统一，即统一保存入口和读取反显。此为背景，将围绕此背景展开技术层面的代码设计。





##### 面临的问题

- ##### 在保存变更的时候，如果需要进行转义的字段如何处理

  - 方案一：保存的时候只保留原值，读取的时候在逻辑中进行转义。
  - 方案二：保存的时候转义并落库，读取的时候直接读。

  以上两个方案都存在一定的局限性，若使用方案一则会导致在读取的时候需要根据业务场景做不同的转义逻辑；同样方案二则会导致在存储的时候也需要根据业务场景做逻辑转义；

  这种情况下，如果做成同一个接口，则堆叠的逻辑越来越多，难以维护。如果分散开来开发，则相同的处理分散到不同的接口，同样难以维护。

- 字段转义的灵活性，我们在字段转义中，每个人有不同的习惯，或者说不同的字段类型有不同的处理形式，如枚举、字典表等形式，这就很考验设计的灵活性，需要考虑到转义形式扩展。



---



##### 设计方案

- ##### 领域/业务区分

  - 使用类注解进行领域/业务类的标识。

- ##### 新老对象的对比

  - 使用注解的形式对需要记录变更的字段进行标识。
  
- ##### 【*】码值转义如何实现

  - 预设事件、后置事件执行
  - 特定处理句柄handle
  - 转义相关功能灵活组合                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             




